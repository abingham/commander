
# Aim is for cyber-dojo script to boil down to straight delegation.
#
# ./cyber-dojo up
# ./cyber-dojo up --languages=james/cppu

#!/bin/bash
set -e

readonly VERSIONER=cyberdojo/versioner:latest
readonly ENV_VARS=$(docker run --rm ${VERSIONER} sh -c 'cat /app/.env')
readonly COMMANDER_VAR=$(echo "${ENV_VARS}" | grep 'CYBER_DOJO_COMMANDER_SHA')
readonly COMMANDER_SHA=$(echo ${COMMANDER_VAR:25:99})
readonly COMMANDER_TAG=${COMMANDER_SHA:0:7}

docker run \
   --env CYBER_DOJO_CUSTOM \
   --env CYBER_DOJO_EXERCISES \
   --env CYBER_DOJO_LANGUAGES \
   --env CYBER_DOJO_PORT \
   --env CYBER_DOJO_SH_ROOT="${my_dir}" \
   --env CYBER_DOJO_ENV_ROOT=/tmp/app \
   --interactive \
   --rm \
   --volume=/var/run/docker.sock:/var/run/docker.sock \
   cyberdojo/commander:${COMMANDER_TAG} \
     cyber-dojo.rb $@

# Note. Will need to add volume-mounts for nginx.env etc.
# Note. Will I still need SH_ROOT?
# Note. Will I still need ENV_ROOT?
# Note. No need to pass DOCKER_MACHINE_NAME and OSTYPE to allow commander to
#       see if are running on ToolBox if a [start-point create] GIT_REPO_URL
#       cannot be resolved. start-point-create runs locally (outside the container)
#       anyway
