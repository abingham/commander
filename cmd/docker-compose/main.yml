
version: '2.2'

services:

  # - - - - - - - - - - - - - - - - - - - - - - -
  # multi-threaded front-end with http caching
  nginx:
    user: root
    init: true
    container_name: cyber-dojo-nginx
    restart: on-failure

  # - - - - - - - - - - - - - - - - - - - - - - -
  # main server (rails)
  web:
    user: nobody
    init: true
    container_name: cyber-dojo-web
    environment:
      - CYBER_DOJO_SHA
      - CYBER_DOJO_RELEASE
    restart: on-failure

  # - - - - - - - - - - - - - - - - - - - - - - -
  # start-points
  custom:
    user: nobody
    init: true
    container_name: cyber-dojo-custom
    read_only: true
    tmpfs: /tmp
    restart: on-failure

  exercises:
    user: nobody
    init: true
    container_name: cyber-dojo-exercises
    read_only: true
    tmpfs: /tmp
    restart: on-failure

  languages:
    user: nobody
    init: true
    container_name: cyber-dojo-languages
    read_only: true
    tmpfs: /tmp
    restart: on-failure

  # - - - - - - - - - - - - - - - - - - - - - - -
  # runs cyber-dojo.sh in time-boxed container
  runner:
    user: root
    init: true
    container_name: cyber-dojo-runner
    read_only: true
    tmpfs: /tmp
    restart: on-failure

  # - - - - - - - - - - - - - - - - - - - - - - -
  # convert runner's [stdout,stderr,status] to red/amber/green
  ragger:
    user: nobody
    init: true
    container_name: cyber-dojo-ragger
    read_only: true
    tmpfs: /tmp
    restart: on-failure

  # - - - - - - - - - - - - - - - - - - - - - - -
  # stores groups/katas and code+tests for every test event
  saver:
    user: saver
    init: true
    container_name: cyber-dojo-saver
    read_only: true
    tmpfs: /tmp
    restart: on-failure

  # - - - - - - - - - - - - - - - - - - - - - - -
  # holds storer->saver id mappings created by porter
  mapper:
    user: nobody
    init: true
    container_name: cyber-dojo-mapper
    read_only: true
    tmpfs: /tmp
    restart: on-failure

  # - - - - - - - - - - - - - - - - - - - - - - -
  # diffs all the files in two test events
  differ:
    user: nobody
    init: true
    container_name: cyber-dojo-differ
    read_only: true
    tmpfs: /tmp
    restart: on-failure

  # - - - - - - - - - - - - - - - - - - - - - - -
  # provides tgz files of practice sessions
  zipper:
    user: nobody
    init: true
    container_name: cyber-dojo-zipper
    read_only: true
    tmpfs: /tmp
    restart: on-failure

  # - - - - - - - - - - - - - - - - - - - - - - -
  # monitoring
  prometheus:
    init: true
    container_name: cyber-dojo-prometheus
    tmpfs: /tmp
    restart: on-failure

  grafana:
    init: true
    container_name: cyber-dojo-grafana
    tmpfs: /tmp
    restart: on-failure
